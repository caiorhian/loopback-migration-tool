{"version":3,"sources":["seeder.js"],"names":["app","file","debug","info","isAbsolute","process","cwd","seeder","require","isFunction","default","length","promisify","runSeedFile","argv","promises","map","models","Model","dataSource","destroyAll","resolve","all","src","files","sort","i","j"],"mappings":"AAAA;AACA;;;;;;;;;;;;;;;;;2EA6BA,kBAA2BA,GAA3B,EAAgCC,IAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AACI,8CAAGC,KAAH,CAASC,IAAT,aAAwBF,IAAxB;AACA,4BAAI,CAAC,eAAKG,UAAL,CAAgBH,IAAhB,CAAL,EAA4B;AACxBA,mCAAUI,QAAQC,GAAR,EAAV,SAA2BL,IAA3B;AACH;;AAEGM,8BANR,GAMiBC,QAAQP,IAAR,CANjB;;AAOI,4BAAI,CAAC,iBAAEQ,UAAF,CAAaF,MAAb,CAAD,IAAyBA,OAAOG,OAApC,EAA6C;AACzCH,qCAASA,OAAOG,OAAhB;AACH;AACD,4BAAIH,OAAOI,MAAP,KAAkB,CAAtB,EAAyB;AACrBJ,qCAAS,mBAAQK,SAAR,CAAkBL,MAAlB,CAAT;AACH;AAZL;AAAA,+BAaUA,OAAOP,GAAP,CAbV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAea,W;;;;;AA1Bf;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;0EAEe,iBAAgBC,IAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACPd,2BADO,GACD,sBAAUc,KAAKd,GAAf,CADC;AAGPe,gCAHO,GAGI,iBAAEC,GAAF,CAAMhB,IAAIiB,MAAV,EAAkB,UAAUC,KAAV,EAAiB;AAC9C,gCAAIA,MAAMC,UAAN,IAAoB,iBAAEV,UAAF,CAAaS,MAAME,UAAnB,CAAxB,EAAwD;AACpD,uCAAOF,MAAME,UAAN,EAAP;AACH;AACD,mCAAO,mBAAQC,OAAR,EAAP;AACH,yBALc,CAHJ;AAAA;AAAA,+BASL,mBAAQC,GAAR,CAAYP,QAAZ,CATK;;AAAA;AAAA;AAAA,+BAWO,mBAAQH,SAAR,iBAAwBE,KAAKS,GAA7B,CAXP;;AAAA;AAWPC,6BAXO;;AAYXA,gCAAQA,MAAMC,IAAN,EAAR;;AAESC,yBAdE,GAcE,CAdF,EAcKC,CAdL,GAcSH,MAAMb,MAdf;;AAAA;AAAA,8BAcuBe,IAAIC,CAd3B;AAAA;AAAA;AAAA;;AAAA;AAAA,+BAeDd,YAAYb,GAAZ,EAAiBwB,MAAME,CAAN,CAAjB,CAfC;;AAAA;AAc8BA,2BAd9B;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K","file":"seeder.js","sourcesContent":["\"use strict\"\n/**\n * Created by garusis on 31/01/17.\n */\nimport _ from \"lodash\"\nimport glob from \"glob\"\nimport Promise from \"bluebird\"\nimport path from \"path\"\nimport dh from \"debug-helper\"\nimport {appLoader} from \"./utils\"\n\nexport default async function (argv) {\n    let app = appLoader(argv.app)\n\n    let promises = _.map(app.models, function (Model) {\n        if (Model.dataSource && _.isFunction(Model.destroyAll)) {\n            return Model.destroyAll()\n        }\n        return Promise.resolve()\n    })\n    await Promise.all(promises)\n\n    let files = await Promise.promisify(glob)(argv.src)\n    files = files.sort()\n\n    for (let i = 0, j = files.length; i < j; i++) {\n        await runSeedFile(app, files[i])\n    }\n}\n\nasync function runSeedFile(app, file) {\n    dh.debug.info(`Runing ${file} seed file`)\n    if (!path.isAbsolute(file)) {\n        file = `${process.cwd()}/${file}`\n    }\n\n    let seeder = require(file)\n    if (!_.isFunction(seeder) && seeder.default) {\n        seeder = seeder.default\n    }\n    if (seeder.length === 2) {\n        seeder = Promise.promisify(seeder)\n    }\n    await seeder(app)\n}"],"sourceRoot":"./"}