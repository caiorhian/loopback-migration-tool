{"version":3,"sources":["seeder.js"],"names":["argv","app","promises","map","models","Model","destroyAll","all","resolve","reject","src","err","files","file","isAbsolute","process","cwd","seeder","require","isFunction","default","length","promisify","then","catch"],"mappings":"AAAA;AACA;;;;;;;;;;;;;;;;AAGA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;0EAEe,iBAAgBA,IAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,2BADO,GACD,sBAAUD,KAAKC,GAAf,CADC;AAGPC,gCAHO,GAGI,iBAAEC,GAAF,CAAMF,IAAIG,MAAV,EAAkB,UAACC,KAAD;AAAA,mCAAWA,MAAMC,UAAN,EAAX;AAAA,yBAAlB,CAHJ;AAAA;AAAA,+BAIL,mBAAQC,GAAR,CAAYL,QAAZ,CAJK;;AAAA;AAAA;AAAA,+BAME,uBAAY,UAAUM,OAAV,EAAmBC,MAAnB,EAA2B;AAChD,gDAAKT,KAAKU,GAAV,EAAe,UAAUC,GAAV,EAAeC,KAAf,EAAsB;AACjC,oCAAID,GAAJ,EAAS,OAAOF,OAAOE,GAAP,CAAP;AACTT,2CAAW,iBAAEC,GAAF,CAAMS,KAAN,EAAa,UAAUC,IAAV,EAAgB;AACpC,wCAAI,CAAC,eAAKC,UAAL,CAAgBD,IAAhB,CAAL,EAA4B;AACxBA,+CAAUE,QAAQC,GAAR,EAAV,SAA2BH,IAA3B;AACH;;AAED,wCAAII,SAASC,QAAQL,IAAR,CAAb;AACA,wCAAI,CAAC,iBAAEM,UAAF,CAAaF,MAAb,CAAD,IAAyBA,OAAOG,OAApC,EAA6C;AACzCH,iDAASA,OAAOG,OAAhB;AACH;AACD,wCAAIH,OAAOI,MAAP,KAAkB,CAAtB,EAAyB;AACrBJ,iDAAS,mBAAQK,SAAR,CAAkBL,MAAlB,CAAT;AACH;AACD,2CAAOA,OAAOhB,GAAP,CAAP;AACH,iCAbU,CAAX;AAcA,mDAAQM,GAAR,CAAYL,QAAZ,EACKqB,IADL,CACUf,OADV,EAEKgB,KAFL,CAEWf,MAFX;AAGH,6BAnBD;AAoBH,yBArBY,CANF;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K","file":"seeder.js","sourcesContent":["\"use strict\"\n/**\n * Created by garusis on 31/01/17.\n */\nimport _ from \"lodash\"\nimport glob from \"glob\"\nimport Promise from \"bluebird\"\nimport path from \"path\"\nimport debug from \"debug\"\nimport {appLoader} from \"./utils\"\n\nexport default async function (argv) {\n    let app = appLoader(argv.app)\n\n    let promises = _.map(app.models, (Model) => Model.destroyAll())\n    await Promise.all(promises)\n\n    return await new Promise(function (resolve, reject) {\n        glob(argv.src, function (err, files) {\n            if (err) return reject(err)\n            promises = _.map(files, function (file) {\n                if (!path.isAbsolute(file)) {\n                    file = `${process.cwd()}/${file}`\n                }\n\n                let seeder = require(file)\n                if (!_.isFunction(seeder) && seeder.default) {\n                    seeder = seeder.default\n                }\n                if (seeder.length === 2) {\n                    seeder = Promise.promisify(seeder)\n                }\n                return seeder(app)\n            })\n            Promise.all(promises)\n                .then(resolve)\n                .catch(reject)\n        })\n    })\n}"],"sourceRoot":"./"}