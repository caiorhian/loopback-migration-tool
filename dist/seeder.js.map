{"version":3,"sources":["seeder.js"],"names":["app","file","debug","info","isAbsolute","process","cwd","seeder","require","isFunction","default","length","promisify","runSeedFile","argv","promises","map","models","Model","destroyAll","resolve","all","src","files","sort","i","j"],"mappings":"AAAA;AACA;;;;;;;;;;;;;;;;;2EAwBA,kBAA2BA,GAA3B,EAAgCC,IAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AACI,8CAAGC,KAAH,CAASC,IAAT,aAAwBF,IAAxB;AACA,4BAAI,CAAC,eAAKG,UAAL,CAAgBH,IAAhB,CAAL,EAA4B;AACxBA,mCAAUI,QAAQC,GAAR,EAAV,SAA2BL,IAA3B;AACH;;AAEGM,8BANR,GAMiBC,QAAQP,IAAR,CANjB;;AAOI,4BAAI,CAAC,iBAAEQ,UAAF,CAAaF,MAAb,CAAD,IAAyBA,OAAOG,OAApC,EAA6C;AACzCH,qCAASA,OAAOG,OAAhB;AACH;AACD,4BAAIH,OAAOI,MAAP,KAAkB,CAAtB,EAAyB;AACrBJ,qCAAS,mBAAQK,SAAR,CAAkBL,MAAlB,CAAT;AACH;AAZL;AAAA,+BAaUA,OAAOP,GAAP,CAbV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAea,W;;;;;AArBf;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;0EAEe,iBAAgBC,IAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACPd,2BADO,GACD,sBAAUc,KAAKd,GAAf,CADC;AAGPe,gCAHO,GAGI,iBAAEC,GAAF,CAAMhB,IAAIiB,MAAV,EAAkB,UAACC,KAAD;AAAA,mCAAW,iBAAET,UAAF,CAAaS,MAAMC,UAAnB,IAAiCD,MAAMC,UAAN,EAAjC,GAAsD,mBAAQC,OAAR,EAAjE;AAAA,yBAAlB,CAHJ;AAAA;AAAA,+BAIL,mBAAQC,GAAR,CAAYN,QAAZ,CAJK;;AAAA;AAAA;AAAA,+BAMO,mBAAQH,SAAR,iBAAwBE,KAAKQ,GAA7B,CANP;;AAAA;AAMPC,6BANO;;AAOXA,gCAAQA,MAAMC,IAAN,EAAR;;AAESC,yBATE,GASE,CATF,EASKC,CATL,GASSH,MAAMZ,MATf;;AAAA;AAAA,8BASuBc,IAAIC,CAT3B;AAAA;AAAA;AAAA;;AAAA;AAAA,+BAUDb,YAAYb,GAAZ,EAAiBuB,MAAME,CAAN,CAAjB,CAVC;;AAAA;AAS8BA,2BAT9B;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K","file":"seeder.js","sourcesContent":["\"use strict\"\n/**\n * Created by garusis on 31/01/17.\n */\nimport _ from \"lodash\"\nimport glob from \"glob\"\nimport Promise from \"bluebird\"\nimport path from \"path\"\nimport dh from \"debug-helper\"\nimport {appLoader} from \"./utils\"\n\nexport default async function (argv) {\n    let app = appLoader(argv.app)\n\n    let promises = _.map(app.models, (Model) => _.isFunction(Model.destroyAll) ? Model.destroyAll() : Promise.resolve())\n    await Promise.all(promises)\n\n    let files = await Promise.promisify(glob)(argv.src)\n    files = files.sort()\n\n    for (let i = 0, j = files.length; i < j; i++) {\n        await runSeedFile(app, files[i])\n    }\n}\n\nasync function runSeedFile(app, file) {\n    dh.debug.info(`Runing ${file} seed file`)\n    if (!path.isAbsolute(file)) {\n        file = `${process.cwd()}/${file}`\n    }\n\n    let seeder = require(file)\n    if (!_.isFunction(seeder) && seeder.default) {\n        seeder = seeder.default\n    }\n    if (seeder.length === 2) {\n        seeder = Promise.promisify(seeder)\n    }\n    await seeder(app)\n}"],"sourceRoot":"./"}